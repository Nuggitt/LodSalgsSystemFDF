@page
@using LodSalgsSystemFDF.Pages.LogIn
@model LodSalgsSystemFDF.Pages.Salgs.GetSalgsModel
@{
    ViewData["Title"] = "GetSalgs";

    // Demo-safe helpers
    bool CanManage =
        new[] { "lotteribestyrer", "admin", "leder" }
        .Contains(LogInPageModel.LoggedInBruger?.BrugerNavn);

    var sortedSalgs = Model?.Salgs.OrderByDescending(s => s.Born.AntalSolgteLodseddeler).ToList();
    var highestValueItem = sortedSalgs?.FirstOrDefault();
}

<div class="content-container">
    <h1 class="mt-5 mb-4 text-primary fw-bold text-center">Liste over alle salg</h1>

    @if (highestValueItem != null)
    {
        <div class="supersaelger-card text-center mb-4">
            <h3 class="text-success fw-bold mb-2">üèÜ SUPERS√ÜLGER üèÜ</h3>
            <p><strong>ID:</strong> @highestValueItem.Born_ID</p>
            <p><strong>Navn:</strong> @highestValueItem.Born.Navn</p>
            <p><strong>Solgte lodsedler:</strong> @highestValueItem.Born.AntalSolgteLodseddeler</p>
        </div>
    }

    @if (CanManage)
    {
        <div class="mb-3">
            <a asp-page="/Salgs/Create" class="btn btn-primary">
                <i class="fa fa-plus" aria-hidden="true"></i> Tilf√∏j nyt salg
            </a>
        </div>
    }

    <p>S√∏g efter B√∏rnegruppe ID</p>
    <form method="post" class="form-inline">
        <div class="input-group mb-3">
            <input asp-for="IDSearch" class="form-control mr-1" placeholder="S√∏g efter B√∏rnegruppeID" />
            <input type="submit" asp-page-handler="BornegruppeByID" value="S√∏g" class="btn btn-primary" />
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped table-bordered table-stacked">
            <thead class="thead-dark">
                <tr>
                    <p>Filtrer Efter Pris</p>
                    <form method="post" class="form-inline">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Min</span>
                            </div>
                            <input asp-for="MinPrice" class="form-control mr-1" />
                            <div class="input-group-prepend">
                                <span class="input-group-text">Max</span>
                            </div>
                            <input asp-for="MaxPrice" class="form-control mr-1" />
                            <input type="submit" asp-page-handler="PriceFilter" value="Filter" class="btn btn-primary" />
                        </div>
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    </form>

                    <th>Salg ID</th>
                    <th>B√∏rn ID</th>
                    <th>Barnets navn</th>
                    <th>Barnets Telefon</th>
                    <th>Gruppens navn</th>
                    <th>Leder navn</th>
                    <th>Dato</th>
                    <th>Antal Lodsedler Retur</th>
                    <th>Antal Solgte Lod Pr Salg</th>
                    <th style="column-width:800px">
                        SuperS√¶lger
                        <a data-toggle="tooltip" title="Sorter lodsedler faldende" asp-page-handler="AntalSolgteLodseddelerDESC"><i class="fa fa-angle-down"></i></a>
                        <a data-toggle="tooltip" title="Sorter lodsedler stigende" asp-page-handler="AntalSolgteLodseddelerASC"><i class="fa fa-angle-up"></i></a>
                    </th>
                    <th>Pris</th>

                    @if (CanManage)
                    {
                        <th>Slet Salg</th>
                        <th>Redig√©r Salg</th>
                    }
                </tr>
            </thead>

            <tbody>
                @if (Model?.Salgs != null)
                {
                    foreach (var item in Model.Salgs)
                    {
                        <tr>
                            <td data-label="Salg ID">@item.Salg_ID</td>
                            <td data-label="B√∏rn ID">@item.Born_ID</td>
                            <td data-label="Barnets navn">@item.Born.Navn</td>
                            <td data-label="Barnets Telefon">@item.Born.Telefon</td>
                            <td data-label="Gruppens navn">@item.Bornegruppe.Gruppenavn</td>
                            <td data-label="Leder navn">@item.Leder.Navn</td>
                            <td data-label="Dato">@item.Dato</td>
                            <td data-label="Antal Lodsedler Retur">@item.AntalLodseddelerRetur</td>
                            <td data-label="Antal Solgte Lod Pr Salg">@item.AntalSolgteLodseddelerPrSalg</td>
                            <td data-label="SuperS√¶lger">@item.Born.AntalSolgteLodseddeler</td>
                            <td data-label="Pris">@item.Pris</td>

                            @if (CanManage)
                            {
                                <td data-label="Slet Salg">
                                    <a asp-page="/Salgs/Delete" asp-route-id="@item.Salg_ID">
                                        <i class="fa fa-trash" aria-hidden="true"></i> Slet
                                    </a>
                                </td>
                                <td data-label="Redig√©r Salg">
                                    <a asp-page="/Salgs/Update" asp-route-id="@item.Salg_ID">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Redig√©r
                                    </a>
                                </td>
                            }
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
